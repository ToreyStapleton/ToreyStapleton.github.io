<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Battlefield 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" media="screen" href="style.css">
</head>
<body>
  <ul class="navigation">
    <li class="brand"><a href="/">TS</a></li>
    <li class="title">Battlefield 4 Statistics</li>
    <li class="about"><button class="not-active" type="button" name="button">?</button></li>
  </ul>
  <div class="container">
  </div>
  <div class="footer">
    <a target="blank_" href="http://bf4stats.com/">
      Data provided by bf4stats
    </a>
  </div>
<script>

window.onload = function () {
  xmlData();
};

const endpoint = 'http://api.bf4stats.com/api/onlinePlayers?output=json';
const onlinePlayers = [];
var container = document.querySelector('.container');
var person = document.querySelector('.person');
var button = document.querySelector('button[name="button"]');
var oReq;

button.addEventListener("click", toggleModal);

function toggleModal() {
  if(~this.className.indexOf('not-active') != 0) {
    this.className = "active";
  }
  else {
    this.className = "not-active";
  }
}

function xmlData() {
  oReq = new XMLHttpRequest();
  oReq.onreadystatechange = logContents;
  oReq.onerror = displayError;
  oReq.open('GET', endpoint);
  oReq.send();
};

function logContents() {
  if(!!oReq.response) {
    oReq = JSON.parse(oReq.response);
    return getPlatformInfo();
  }
};

function displayError() {
  var line = document.createElement('div');
  line.setAttribute('class', 'error');
  line.innerHTML = `
  <div class="error_msg">There was an error with the request.  Please try again later.</div>
  `;
  container.appendChild(line);
};


function getPlatformInfo() {
    for(var key in oReq) {
      showPlatform(oReq[key].count, oReq[key].label, oReq[key].peak24)
    };
};

function showPlatform(count, label, peak24) {
  var line = document.createElement('div');
  line.setAttribute('class', 'platform');
  line.innerHTML = `
  <div class="label">${label}</div>
  <div class="count"><img class="icon" src="person.png"><span class="person">Players Online</span><span class="colon">: </span> ${count}</div>
  <div class="peak24"><span class="peak">24 hour peak</span><span class="peakM">24h</span><span class="colon">: </span> ${peak24}</div>
  `;
  container.appendChild(line);
}

</script>
  </body>
</html>
