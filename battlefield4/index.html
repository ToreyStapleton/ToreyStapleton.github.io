<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Battlefield 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" media="screen" href="style.css">
</head>
<body>
  <ul class="navigation">
    <li class="brand"><a href="../">TS</a></li>
    <li class="title">Battlefield 4 Statistics</li>
    <li class="about"><button class="tooltip tooltip-left" data-tooltip="This project was created to practice responsive design without any libraries or frameworks, only plain HTML, CSS, and JavaScript.  This data was simply chosen because the bf4stats endpoint allows cross domain requests without authentication." type="button" name="button">?</button></li>
  </ul>
  <div class="container">
  </div>
  <div class="footer">
    <a target="blank_" href="http://bf4stats.com/">
      Data provided by bf4stats
    </a>
  </div>
<script>

window.onload = function () {
  xmlData();
};

const endpoint = 'http://api.bf4stats.com/api/onlinePlayers?output=json';
var container = document.querySelector('.container');
var person = document.querySelector('.person');
var oReq;

function xmlData() {
  oReq = new XMLHttpRequest();
  oReq.onreadystatechange = logContents;
  oReq.onerror = displayError;
  oReq.open('GET', endpoint);
  oReq.send();
};

function updateData() {
  oReq = new XMLHttpRequest();
  oReq.onreadystatechange = updateContents;
  oReq.onerror = displayError;
  oReq.open('GET', endpoint);
  oReq.send();
}

function logContents() {
  if(!!oReq.response) {
    oReq = JSON.parse(oReq.response);
    return getPlatformInfo();
  }
};

function updateContents() {
  var list = document.querySelectorAll('.platform-row');
  var card = document.querySelectorAll('.platform-card');
  if(!!oReq.response) {
    oReq = JSON.parse(oReq.response);
    for(var key in oReq) {
      for(var i=0; i<list.length; i++) {
        if(~list[i].className.indexOf(oReq[key].label) != 0) {
          list[i].innerHTML = `
          <div class="label">${oReq[key].label}</div>
          <div class="count"><img class="icon" src="person.png"><span class="person">Players Online</span><span class="colon">: </span> ${oReq[key].count}</div>
          <div class="peak24"><span class="peak">24 hour peak</span><span class="peakM">24h</span><span class="colon">: </span> ${oReq[key].peak24}</div>
          `
        }
        if(~card[i].className.indexOf(oReq[key].label) != 0) {
          card[i].innerHTML = `
          <div class="label">${oReq[key].label}</div>
          <div class="count"><img class="icon" src="person.png"><span class="person">Players Online</span><span class="colon">: </span> ${oReq[key].count}</div>
          <div class="peak24"><span class="peak">24 hour peak</span><span class="peakM">24h</span><span class="colon">: </span> ${oReq[key].peak24}</div>
          `
        }
      }
    }
  }
}

function displayError() {
  var line = document.createElement('div');
  line.setAttribute('class', 'error');
  line.innerHTML = `
  <div class="error_msg">There was an error with the request.  Please try again later.</div>
  `;
  container.appendChild(line);
};


function getPlatformInfo() {
    for(var key in oReq) {
      showPlatform(oReq[key].count, oReq[key].label, oReq[key].peak24)
    };
};

function showPlatform(count, label, peak24) {

  var line = document.createElement('div');
  var table = document.createElement('div');
  line.setAttribute('class', 'platform-row');
  table.setAttribute('class', 'platform-card');
  line.className += ' ' + label;
  table.className += ' ' + label;
  line.innerHTML = `
  <div class="label">${label}</div>
  <div class="count"><img class="icon" src="person.png"><span class="person">Players Online</span><span class="colon">: </span> ${count}</div>
  <div class="peak24"><span class="peak">24 hour peak</span><span class="peakM">24h</span><span class="colon">: </span> ${peak24}</div>
  `;

  table.innerHTML = `
  <div class="container-card">
  <div class="label-card">${label}</div>
  </div>
  `
  container.appendChild(line);
  container.appendChild(table);
}

// window.setInterval(updateData, 10000);

</script>
  </body>
</html>
